import{r as s,j as e,n as V}from"./index-D9u3AzuN.js";import{N as R,F as L}from"./Footer-DA8jcI-y.js";import{g as O}from"./OpeningsService-DvE5jbFk.js";import{a as Y}from"./UserService-DHlS3bbm.js";import"./AxiosClient-CAsDCr3W.js";const U="_mainLayout_2qwku_1",F="_mainContent_2qwku_35",D="_quizTitle_2qwku_45",G="_backgroundTransition_2qwku_85",M="_playButton_2qwku_95",Q="_cardPicks_2qwku_135",H="_cardPicksBackground_2qwku_167",J="_show_2qwku_181",W="_endingCharacterContener_2qwku_189",a={mainLayout:U,mainContent:F,quizTitle:D,backgroundTransition:G,playButton:M,cardPicks:Q,"fade-out":"_fade-out_2qwku_151","fade-in":"_fade-in_2qwku_159",cardPicksBackground:H,show:J,endingCharacterContener:W},X="_card_ccpyp_1",K="_video_ccpyp_25",Z="_videoBackground_ccpyp_53",ee="_animeTitle_ccpyp_91",se="_spin_ccpyp_1",ne="_movingBorder_ccpyp_129",te="_moveAround_ccpyp_1",m={card:X,video:K,videoBackground:Z,animeTitle:ee,spin:se,movingBorder:ne,moveAround:te},ae=s.forwardRef(({src:o,title:_,openingNumber:l,onClick:p,className:f,showTitle:u,videoNumber:c},k)=>{const i=s.useRef(null),[v,d]=s.useState(!0);return s.useImperativeHandle(k,()=>i.current,[]),s.useEffect(()=>{const r=i.current;if(r)return r.volume=.2,r.onplay=()=>d(!1),r.onended=()=>d(!0),()=>{d(!0)}},[]),s.useEffect(()=>{d(!0)},[u]),e.jsxs("div",{className:`${m.card} ${f}`,onClick:p,children:[e.jsx("div",{className:m.videoBackground,style:{backgroundImage:`linear-gradient(to bottom right, var(--video-background-${c}-start), var(--video-background-${c}-end))`,display:v&&!u?"flex":"none"},children:e.jsx("p",{children:c})}),e.jsxs("div",{className:m.animeTitle,style:{display:u?"flex":"none"},children:[e.jsx("span",{children:_.toUpperCase()}),e.jsxs("span",{children:["OPENING ",l.toString().toUpperCase()]})]}),e.jsx("div",{className:m.movingBorder,style:{display:u?"flex":"none"}}),e.jsx("video",{className:m.video,src:o,ref:i,playsInline:!0,loop:!1})]})}),re="_year_bxjib_3",oe="_yearNumber_bxjib_21",C={year:re,yearNumber:oe},ce=({year:o})=>e.jsx("div",{className:C.year,children:e.jsx("p",{className:C.yearNumber,children:o})}),ie="_visualizer_1tvq9_1",ue={visualizer:ie},de="/assets/audio_visualizer-B_0vQihf.gif",le=()=>e.jsx("div",{className:ue.visualizer,children:e.jsx("img",{src:de,alt:"Audio Visualizer"})}),pe="/assets/todo_background-C_e9vkyL.png",ge="/assets/ending-character-BRQDT249.png",S="/assets/clap-BhWXJGoe.mp3",me=()=>{const[o,_]=s.useState(0),[l,p]=s.useState(!1),[f,u]=s.useState(!0),[c,k]=s.useState(2e3),[i,v]=s.useState([]),d=s.useRef([]),r=s.useRef(null),[T,y]=s.useState(!1),[j,h]=s.useState(!1),[x,q]=s.useState(!1),[E,w]=s.useState(Array(6).fill(!1)),$=new Date().getFullYear(),N=V(t=>t.user);s.useEffect(()=>{r.current=new Audio(S)},[]),s.useEffect(()=>{if(l){const t=d.current[o];t&&(t.play().catch(n=>{console.error("Error playing video:",n)}),t.onended=()=>{w(n=>{const g=[...n];return g[o]=!0,g}),o<i.length-1?_(n=>n+1):p(!1)})}},[o,l,i]),s.useEffect(()=>{console.log("Updated openings")},[i]);const B=async t=>{try{const n=await O(t);v(n)}catch(n){console.error("Error fetching openings:",n)}},b=()=>{r.current&&(r.current.load(),r.current.play().catch(t=>{console.error("Error playing clap sound:",t)}))},I=async t=>{if(!l){const n=c+1;if(n!==$+1){if(b(),_(0),w(Array(6).fill(!1)),y(!0),h(!0),N){const A={userId:N.id,openingId:t,year:c};try{await Y(A)}catch(z){console.error("Error sending UserClaims to backend:",z)}}k(n),await B(n),setTimeout(()=>{p(!0),y(!1),h(!1)},1e3)}else u(!1),q(!0)}},P=async()=>{u(!1),y(!0),h(!0),b(),await B(c),setTimeout(()=>{p(!0),y(!1),h(!1)},1e3)};return e.jsxs("div",{className:a.mainLayout,children:[e.jsxs("div",{className:a.mainContent,children:[e.jsx(ce,{year:c}),l?e.jsx(le,{}):e.jsx("div",{className:a.quizTitle,children:e.jsx("h1",{children:"ONLY SAVE 1 OPENING!"})})]}),e.jsxs("div",{className:`${a.cardPicks} ${T?a["fade-out"]:a["fade-in"]}`,children:[e.jsx("div",{className:`${a.cardPicksBackground} ${j?a.show:""}`,style:{display:j?"block":"none"},children:e.jsx("img",{className:a.backgroundTransition,src:pe,alt:"background transition"})}),e.jsx("div",{className:`${a.endingCharacterContener} ${x?a.show:""}`,style:{display:x?"flex":"none"},children:e.jsx("img",{className:a.backgroundTransition,src:ge,alt:"background character"})}),f&&e.jsx("button",{className:a.playButton,onClick:P,children:"Play"}),!f&&!x&&i.map((t,n)=>e.jsx(ae,{src:t.src,openingNumber:t.openingNumber,title:t.title,onClick:()=>I(t.id),ref:g=>d.current[n]=g,className:a.cardItem,showTitle:E[n],videoNumber:n+1},n))]}),e.jsx("audio",{ref:r,src:S})]})},_e=me;function je(){return e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(_e,{}),e.jsx(L,{})]})}export{je as default};
